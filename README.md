# Chain Network

[![N|Solid](images/Team.png)](http://startblock.online)

Распределенная система автоматического исполнения обязательств сторон при осуществлении энергосбытовой деятельности с применением технологии блокчейн.

Видео-демонстрация решения: https://youtu.be/04KdeF578HA

![Пример видео](images/final.mp4)


Интерфейсы пользователей: http://greenatom-frontend.herokuapp.com/

```Login: admin/bank/consumer```

```Password: admin_pass/bank_pass/consumer_pass```


# Содержание

<ol type="1" style="font-size: x-large;">
<li> [Проблема](#проблема)
<li> [Задача: автоматическое исполнение обязательств](#задача:-автоматическое-исполнение-обязательств)
<li> [Решение](#solution)
<ol type="a" style="font-size: large;">
  <li> [Используемые компоненты](#используемые-компоненты)
  <li> [Архитектура решения](#архитектура-решения)
  <li> [Частная блокчейн сеть](#частная-блокчейн-сеть)
  <li> [Смарт-контракты](#смарт-контракты)
  <li> ["Умные" датчики](#умные-датчики)
  <li> [Интерфейсы пользователей](#интерфейсы-пользователей)
</ol>
<li> [Установка](#установка)
<ol type="a" style="font-size: large;">
  <li> [Frontend](#frontend)
  <li> [Backend](#backend)
  <li> [Blockchain](#blockchain)
</ol>
<li> [Итоги](#итоги)
<li> [Будущее развитие](#будущее-развитие)
<li> [Команда](#команда)
</ol>

# Проблема

1. Нет достоверного реестра данных с показаниями потребления электроэнергии, расчета и оплаты потребляемых ресурсов каждым пользователем.
2. Нет автоматизации в снятии показаний и проведения транзакций по оплате потребленных ресурсов
3. Нужна быстрая и открытая система для оплаты ресурсов и обмена информацией между всеми участниками сети

# Задача: автоматическое исполнение обязательств

Создать распределенную систему автоматического исполнения обязательств сторон при осуществлении энергосбытовой деятельности с применением технологии блокчейн.

1. развернуть частную сеть и разместить в ней смарт-контракт(ы) для реализации бизнес-логики;
2. реализовать механизм по управлению пользователями, полномочиями и настройками смарт-контрактов в системе через GUI и консоль;
3. реализовать механизм имитации работы сети датчиков потребления электроэнергии;
4. реализовать механизм расчета начислений за электроэнергию на основании подгружаемых внешних данных (показаний приборов учета и данных о применяемом тарифе), а также хранения, пополнения и списания со счетов за пользование электроэнергией;
5. реализовать личный кабинет пользователя, банковского оператора и администратора.

# Решение

- Использование Waves Enterprise для создания частной сети  и настройки нод. 
- ГОСТ криптография.
- Настраиваемые роли в системе. 
- Использование докер-контрактов.

Видео-демонстрация решения: https://youtu.be/04KdeF578HA
![Пример видео](images/final.mp4)


Интерфейсы пользователей: http://greenatom-frontend.herokuapp.com/

```Login: admin/bank/consumer```

```Password: admin_pass/bank_pass/consumer_pass```

### Используемые компоненты

- Waves Enterprise - частная блокчейн сеть для осуществления настраивания ролей в распределенной системе
- 3 ноды в системе с разными ролями для обеспечения безопасности системы и возможностью масштабирования
- Смарт-контракт для автоматического исполнения операций по снятию данных с приборов и осуществления оплаты, а также верификации участников
- Смарт-контракт для задания тарифов по оплате электроэнергии любой сложности
- RaspberyPI - "умный счетчик" считает потребляемую энергию и отправляет подписанные показания в смарт-контракт
- Пользовательские интерфейсы для Администратора сети, Потребителя и Банковского оператора
- Бэкенд для сбора данных о показаниях прибора и выставляемых счетах из блокчейна с возможностью выгрузки в Exel

### Архитектура решения

1) Пользователь устанавливает прибор учета на предприятии и подключает его к частной блокчейн сети. Для этого администратор верифицирует прибор и вшивает private key в каждый прибор, который шифруется паролем пользователя.
Raspbery PI как "умный счетчик" считает потребляемую электроэнергию и отправляет показания в смарт-контракт.

2) Администратор сети заходит в личный кабинет где может добавить нового пользователя. (Разворачивается нода с ролью майнера для крупного пользователя) 
После этого регистрирует новые приборы учета и выбирает тариф (создается смарт-контракт для данного пользователя в сети)

3) Пользователь видит зарегистрированные приборы учета в своем ЛК и показания по ним, которые периодически обновляются.
На балансе пользователя есть токены, которыми происходит оплата. Токены регулируюся и начисляются банком пропорционально расчетному счету пользователя.

4) Пользовытель видит итоговые показания в ЛК и может выгрузить Excel со всеми показаниями за месяц с периодичностью в один день и итог за месяц.
Также у него есть сформиромированный и автоматически оплаченный счет, если на балансе есть средства.

5) Оператор банка в личном кабинете может просмотреть всех пользователей, сформированные счета для каждого и статус оплаты. Платеж разбит на 3 этапа. Также возможно выгрузить Excel с подробным описанием платежей.

![N|Solid](images/1.png)

Благодаря архитектуре и распределению ролей система может масштабироваться, путем добавления новых нод.

![N|Solid](images/2.png)

### Частная блокчейн сеть

Архитектура частной сети нашего тестового решения предполагает наличие нод со следующими ролями, настроенные в сети Waves Enterprise:

1. Администратор 

+ Permissioner - управление ролями в сети
+ Miner - майнер сети
+ Connection manager - управление подключением к сети новых участников
+ Contract creator - создатель смарт-контрактов
+ Blacklister - добавление в черный список и блокировка пользователей

2. Банк

+ Issuer - выпуск токенов
+ Miner - майнер сети

3. Потребитель

+ Miner - майнер сети

Для последующего масштабирования возможно подключение большего количества пользователей и увеличения нод. Также в итоговой версии следует подумать об распределение ролей администратора между несколькими участниками.

![N|Solid](images/3.png)

### Смарт-контракты

Основная архитектура смарт-контрактов приведена на рисунке:

![N|Solid](images/1.png)

Смарт-контракт пользователя (докер и RIDE версии):

1. Инициализируется администратором. 
	При инициализации в state смарт-контракта заносятся:
		- Waves адрес обслуживающего банка,
		- Waves адрес администратора
		- id токена в которых происходят расчеты (обеспечение токена - валюта на счете в банке) 
2. Имеет следующие методы:
	send_data(amount) - метод для отправки данных от счетчика каждые пол-часа. Если статус счетчика - active, то показание записывается в state смарт-контракта

	makePayment(meterAddress, price) - метод для проведения авансовых и ежемесячных платежей. Может вызываться только банком.
	в случае успешного платежа - вызывается метод смарт-контракта банка, который меняет остаток на счете пользователя и записывает данные о платежи в свое состояние.

Смарт-контракт банка:
	Предназначен для управления балансами пользоваетельских счетов и хранения информации о платежах

Смарт-контракт администратора:
	Позволяет изменять статус пользователей, добавлять новых

### "Умные" датчики

В качестве умных датчиков были использованы Raspbery PI, считывающие показатели потребляемой электроэнергии и отправляющие в блокчейн информацию, путем подключения к интернету.

![N|Solid](images/4.jpg)

### Интерфейсы пользователей

Интерфейсы пользователей: http://greenatom-frontend.herokuapp.com/

1. Личный кабинет Администратора

- Возможность просматривания всех пользователей
- Возможность добавить нового пользователя
- Возможность добавить новые приборы учета
- Возможность установить Тариф для пользователя.

![N|Solid](images/5.png)

2. Личный кабинет Пользователя

- Возможность просматривать измерения по счетчикам
- Возможность получить выгрузку в Excel из блокчейна по измерениям за месяц
- Возможность просматривать счета и приборы учета

![N|Solid](images/6.png)

3. Личный кабинет Банковского Оператора

- Возможность просматривания всех пользователей
- Возможность просматривать измерения по статусу и оплаты счетов
- Возможность получить выгрузку в Excel из блокчейна по счетам

Пример Excel выгрузки - https://docs.google.com/spreadsheets/d/1h64GhMYVZQa9KzNcZ8EpwRnA0rKHV1hmMbOLLw6povs

![N|Solid](images/7.png)

# Установка

### Frontend

```yarn install```

```yarn build```

```yarn start```

### Backend

```yarn install```

```yarn build```

```yarn start```

### Blockchain

Чтобы разыернуть приватную сеть состоящую из 3 нод необходимо выполнить следующие шаги: 
- из корневой директории выполнить <code>cd we-network</code>
- <code>docker-compose up</code> 
- скрипты для добавления нодам прав, деплоя смарт-контрактов, обращения к смарт контрактам и тд. здесь <code>waves-scripts</code>


# Итоги

В качестве решения на хакатоне было сделано:
- развернута тестовая сеть на основе Waves Enterprise на 3 ноды
- реализованы роли для каждой из нод с учетом масштабирования
- реализованы 3 типа интерфейсов с бизнес-логикой: Пользователь, Банковский оператор, Администратор
- написан смарт-контракт для автоматизации сбора данных с приборов учета и создания счетов на оплату
- прототип прибора учета и связь с блокчейн-сетью

Решение представляет собой полностью работающий прототип связаннной системы: датчик учета, WE блокчейн и смарт-контракты, UI пользователей.

Видео-демонстрация решения: https://youtu.be/04KdeF578HA
![Пример видео](images/final.mp4)

Интерфейсы пользователей: http://greenatom-frontend.herokuapp.com/

```Login: admin/bank/consumer```

```Password: admin_pass/bank_pass/consumer_pass```

# Будущее развитие

В дальнейшем наша команда StartBlock.Online готова продолжить разработку данной системы на уровне проведения пилота и внедрения в реальный бизнес.

Провести полную аналитику бизнес-требований и предложить наиболее полную конфигурацию для масштабирования системы.

Реализовать полную структуру решения, используя платформы Waves Enterprise, Waves, Hyperledger, Ethereum.

Опираясь на опыт реализации подобной архитектуры на Ethereum.


# Команда

[![N|Solid](images/Team.png)](http://startblock.online)
